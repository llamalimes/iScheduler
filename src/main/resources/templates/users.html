<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Dashboard</title>
    <!-- Add Bootstrap CSS link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header class="bg-dark text-white py-4">
    <div class="container">
        <h1><span th:text="${name}"></span>'s Scheduler Dashboard</h1>
        <!-- Add navigation links here -->
    </div>
</header>

<main class="container py-4">
    <!-- Display error message -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>
    <!-- Link to modify availability form -->
    <a href="/availability/modify" class="btn btn-primary mb-3">Modify Availability</a>

    <section id="friend-list" class="mb-4">
        <h2>Friend List
            <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#friend-list-collapse" aria-expanded="false" aria-controls="friend-list-collapse" id="friend-list-btn">
                <span class="fs-4"></span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M7.646 10.854a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 .708-.708L8 9.293l6.354-6.353a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1 0 .708z"/>
                </svg>
            </button>
        </h2>
        <div class="collapse" id="friend-list-collapse">
            <ul class="list-group">
                <li th:each="friend : ${friends}" class="list-group-item d-flex justify-content-between align-items-center">
                    <span th:text="${friend.name}"></span>
                    <form th:action="@{/remove-friend}" th:object="${friend}" method="post">
                        <input type="hidden" name="friendEmail" th:value="${friend.email}">
                        <button type="submit" class="btn btn-danger">Remove</button>
                    </form>
                </li>
            </ul>
            <form action="/add-friend" method="post">
                <div class="mb-3">
                    <br>
                    <label for="friendEmail" class="form-label">Add Friend</label>
                    <input type="text" class="form-control" id="friendEmail" name="friendEmail" placeholder="Enter friend's email">
                </div>
                <button type="submit" class="btn btn-primary">Add Friend</button>
            </form>
        </div>
    </section>
    <section id="view-availability" class ="mb-4">
        <h1>User Availability</h1>
        <div th:each="availability : ${user.availabilities}">
            <h2 th:text="${availability.dayOfWeek}"></h2>
            <ul>
                <li th:each="timeBlock : ${availability.timeBlocks}">
                    <span th:text="${timeBlock.startTime} + ' - ' + ${timeBlock.endTime}"></span>
                </li>
            </ul>
        </div>
    </section>
    <!--section id="edit-availability" class="mb-4">
        <h1>Set Availability</h1>

        <div th:each="availability : ${availabilities}">

            <form th:action="@{/availability/save}" th:object="${availability}" method="post">
                <label for="dayOfWeek">Day of Week:</label>
                <select id="dayOfWeek" name="dayOfWeek">
                    <option value="MONDAY">Monday</option>
                    <option value="TUESDAY">Tuesday</option>
                    <option value="WEDNESDAY">Wednesday</option>
                    <option value="THURSDAY">Thursday</option>
                    <option value="FRIDAY">Friday</option>
                    <option value="SATURDAY">Saturday</option>
                    <option value="SUNDAY">Sunday</option>
                </select><br>

                <div th:each="block, blockStat : ${availability.timeBlocks}" class="time-block">
                    <label th:for="'startTime' + ${blockStat.index}">Start Time:</label>
                    <input type="time" th:id="'startTime' + ${blockStat.index}" th:field="*{timeBlocks[__${blockStat.index}__].startTime}" name="startTime"><br>

                    <label th:for="'endTime' + ${blockStat.index}">End Time:</label>
                    <input type="time" th:id="'endTime' + ${blockStat.index}" th:field="*{timeBlocks[__${blockStat.index}__].endTime}" name="endTime"><br>
                </div>

                <button type="button" id="addTimeBlock">Add Time Block</button><br>

                <input type="submit" value="Save">
            </form>

        </div>

    </section-->

    <!--section id="view-calendar">
        <h2>View Calendar</h2>
        <iframe src="https://calendar.google.com/calendar/embed?src=3a4e265c947c002424c4213d7fc057bfd0346d636eb8e6ac44f9c1148bfe5066@group.calendar.google.com" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>
    </section-->
</main>

<footer class="bg-dark text-white py-4">
    <div class="container">
        <p>&copy; 2024 Your Scheduler App</p>
    </div>
</footer>

<!-- Add Bootstrap JS and jQuery -->
<!-- script th:inline="javascript">
    /*<![CDATA[*/
    let blockIndex = 0;
    /*[[${availabilities != null ? #lists.size(availability.timeBlocks) : 0}]]*/


    document.getElementById('addTimeBlock').addEventListener('click', function() {
        let blockDiv = document.createElement('div');
        blockDiv.classList.add('time-block');

        let index = blockIndex++;

        let startTimeLabel = document.createElement('label');
        startTimeLabel.setAttribute('for', 'startTime' + index);
        startTimeLabel.textContent = 'Start Time:';

        let startTimeInput = document.createElement('input');
        startTimeInput.setAttribute('type', 'time');
        startTimeInput.setAttribute('id', 'startTime' + index);
        startTimeInput.setAttribute('name', 'startTime');

        let endTimeLabel = document.createElement('label');
        endTimeLabel.setAttribute('for', 'endTime' + index);
        endTimeLabel.textContent = 'End Time:';

        let endTimeInput = document.createElement('input');
        endTimeInput.setAttribute('type', 'time');
        endTimeInput.setAttribute('id', 'endTime' + index);
        endTimeInput.setAttribute('name', 'endTime');

        blockDiv.appendChild(startTimeLabel);
        blockDiv.appendChild(startTimeInput);
        blockDiv.appendChild(document.createElement('br'));
        blockDiv.appendChild(endTimeLabel);
        blockDiv.appendChild(endTimeInput);
        blockDiv.appendChild(document.createElement('br'));

        document.querySelector('form').appendChild(blockDiv);
    });
    /*]]>*/
</script-->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
